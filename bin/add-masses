#!/usr/bin/env python

"""read in Phil's csv files and add in columns for component masses and chirp mass. If outpath is not provided, will overwrite inpath in place
"""
__author__ = "Reed Essick (reed.essick@gmail.com)"

#-------------------------------------------------

import numpy as np

from argparse import ArgumentParser

### non-standard libraries
from universality.utils import io

#-------------------------------------------------

parser = ArgumentParser(description=__doc__)

parser.add_argument('input', type=str)
parser.add_argument('output', default=None, type=str)

parser.add_argument('-v', '--verbose', default=False, action='store_true')

args = parser.parse_args()
N = len(args)
if args.output is None:
    args.output = args.input

#-------------------------------------------------

if args.verbose:
    print('loading: '+inpath)
data, cols = io.load(args.inpath, names=True, delimiter=',')

if args.verbose:
    print('computing additional mass parameters')
Mtot = data[:, cols.index('Mtot')]
q = data[:, cols.index('q')]

m1 = Mtot/(1.+q)
m2 = q*m1

Mc = (m1*m2)**0.6/Mtot**0.2

if args.verbose:
    print('writing: '+args.outpath)

fields = data.dtype.fields.keys()
newfields = ['m1', 'm2', 'Mc']
atad = np.empty((len(data), len(fields)+len(newfields)), dtype=float)
atad[:,:len(fields)] = data
atad[:,-3] = m1
atad[:,-2] = m2
atad[:,-1] = Mc

io.write(args.outpath, atad, fields+newfields)
